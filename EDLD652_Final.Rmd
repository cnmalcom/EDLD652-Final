---
title: "EDLD652 Final"
author: "Diana Dewald, Eliott Doyle"
date: "2/10/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(rio)
library(here)
library(tidytext)
library(RColorBrewer)

#opening and removing about 90% of the rows since the file was too big to push! This code won't work since I got rid of the blogtext.csv file 
#data1 <- import(here("blogtext.csv"))
#data1 <- data1[-(60000:681284),]
#write.csv(data1, "blogtextabbr.csv")

#reading in the new df with fewer observations
data <- import(here("blogtextabbr.csv"))
```

```{r setup2, include=FALSE}
#making all text in 'text' lowercase
data <- data %>% 
  mutate(text = tolower(text))

#View(data)

m_age <- mean(data$age, na.rm = T)
m_age
max_age <- max(data$age, na.rm = T)
max_age
min_age <- min(data$age, na.rm = T)
min_age

#creating a new column with three groups for age
data <- data %>% 
  mutate(agegroup = cut(age, 
                        breaks =c (-Inf, 19.9, 30, Inf), 
                        labels=c("Under 20","20s","Over 30")))
head(data)
```

# Description of the data
#### The data used for this project are from https://www.kaggle.com/rtatman/blog-authorship-corpus, a text dataset of approximately 681000 blogposts. For the purposes of this project, we will be working with one tenth of the full dataset. In addition to the text of each blog post, some information about each the post (topic, date posted) and blogger (gender, age, astrological sign) is included.

# Research question 1:
## What are the most frequently used words in all writing samples?

```{r rq1, warning= FALSE, echo = FALSE}
#parsing words from the 'text' column
tidy_words <- data %>% 
  unnest_tokens(word, text)
tidy_words

#removing numbers
tidy_words <- tidy_words[-grep("\\b\\d+\\b", tidy_words$word),]

#removing 'nbsp' and 'urlink' - THIS DOESN"T WORK! not sure why currently
#exclu <- tibble(word = c("nbsp","urlinkl"))
#tidy_words <- tidy_words %>% 
#  anti_join(exclu, by = "word")
#head(tidy_words)

#counting most frequently occurring words, removing stop words from counts
tidy_words %>% 
  anti_join(stop_words) %>%
  count(word, sort = TRUE)

#plot
tidy_words %>% 
  anti_join(stop_words) %>% 
  count(word, sort = TRUE) %>% 
  mutate(word = reorder(word, n)) %>% # make y-axis ordered by n
  slice(1:15) %>% # select only the first 15 rows
  ggplot(aes(n, word)) +
  geom_col(fill = "cornflowerblue") +
  scale_x_continuous(expand = c(0,0)) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_line(color = "gray80")
  ) +
  labs(
    x = "Word Frequency",
    y = "Word",
    title = "Top 15 most frequently occurring words across all blog posts",
    caption = "Data abbreviated from https://www.kaggle.com/rtatman/blog-authorship-corpus"
  )
```
# Research question 2:
## 

```{r rq2, warning= FALSE, echo = FALSE}

```





# Research question 3:
## Is there a relationship between blog post length and date posted? 

```{r q3}
#new df, converting the date column to dates
rq3 <- data
rq3$date <- gsub(",", "/", rq3$date)
#head(rq3)
rq3$date <- gsub("January", "01", rq3$date)
rq3$date <- gsub("February", "02", rq3$date)
rq3$date <- gsub("March", "03", rq3$date)
rq3$date <- gsub("April", "04", rq3$date)
rq3$date <- gsub("May", "05", rq3$date)
rq3$date <- gsub("June", "06", rq3$date)
rq3$date <- gsub("July", "07", rq3$date)
rq3$date <- gsub("August", "08", rq3$date)
rq3$date <- gsub("September", "09", rq3$date)
rq3$date <- gsub("October", "10", rq3$date)
rq3$date <- gsub("November", "11", rq3$date)
rq3$date <- gsub("December", "12", rq3$date)
#head(rq3)
rq3$date <- as.Date(rq3$date, format="%d/%m/%Y")
#head(rq3)

#word counts for each blog post
#"cont of the number of words for every id/text/date combination"
#"summing within idâ€™s"
rq3_plot <- rq3 %>% 
  select(id, text, date, agegroup) %>% 
  group_by(id, text, date, agegroup) %>% 
  unnest_tokens(word, text) %>% 
  summarize(count = n()) %>% 
  ggplot(aes(x=date, 
             y=count,
             colour = agegroup)) +
  geom_point(alpha = .5) +
  theme_bw() +
  scale_color_brewer(palette="Blues") +
  scale_y_log10(labels = scales::comma) +
  scale_x_date(date_labels = "%Y", expand = c(0,0)) +
  geom_smooth(method=lm, se=FALSE) +
  labs(
    x = "Date Posted",
    y = "Number of Words",
    title = "Word Count by Blogger by Date",
    color = "Blogger Age"
  ) 

rq3_plot

```


